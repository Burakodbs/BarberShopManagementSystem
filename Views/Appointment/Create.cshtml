@model BarberShopManagementSystem.Models.Appointment

@{
    ViewData["Title"] = "Create Appointment";
}

<h2>Create Appointment</h2>

<div class="alert alert-info">
    <p>Please select a date and time for your appointment. Only available times are shown.</p>
</div>

<form asp-action="Create" method="post">
    <div class="form-group">
        <label asp-for="SalonId" class="control-label">Salon</label>
        <select asp-for="SalonId" class="form-control" asp-items="ViewBag.SalonId" id="SalonId" onchange="updateAvailableTimes()"></select>
        <span asp-validation-for="SalonId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="ServiceId" class="control-label">Service</label>
        <select asp-for="ServiceId" class="form-control" asp-items="ViewBag.ServiceId"></select>
        <span asp-validation-for="ServiceId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="EmployeeId" class="control-label">Employee</label>
        <select asp-for="EmployeeId" class="form-control" asp-items="ViewBag.EmployeeId"></select>
        <span asp-validation-for="EmployeeId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label class="control-label">Appointment Date and Time</label>
        <input type="date" class="form-control" id="AppointmentDate" min="@ViewBag.Today" onchange="updateAvailableTimes()" />
        <select class="form-control" id="AppointmentTime"></select>
        <input type="hidden" id="RandevuZamani" name="RandevuZamani" />
        <span asp-validation-for="RandevuZamani" class="text-danger"></span>
    </div>

    <div class="form-group">
        <input type="submit" value="Create Appointment" class="btn btn-primary" />
    </div>
</form>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    <script>
        async function updateAvailableTimes() {
            const salonId = document.getElementById('SalonId').value;
            const date = document.getElementById('AppointmentDate').value;

            if (salonId && date) {
                const response = await fetch(`/Appointment/GetAvailableTimes?salonId=${salonId}&date=${date}`);
                const times = await response.json();

                const timeDropdown = document.getElementById('AppointmentTime');
                timeDropdown.innerHTML = '';

                times.forEach(time => {
                    const option = document.createElement('option');
                    option.value = time;
                    option.textContent = time;
                    timeDropdown.appendChild(option);
                });
            }
        }

        document.getElementById('AppointmentTime').addEventListener('change', () => {
            const date = document.getElementById('AppointmentDate').value;
            const time = document.getElementById('AppointmentTime').value;

            if (date && time) {
                document.getElementById('RandevuZamani').value = `${date}T${time}`;
            }
        });
    </script>
}
